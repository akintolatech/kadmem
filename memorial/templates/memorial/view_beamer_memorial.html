{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Slide show</title>
</head>
<body>

  <div class="slider-container">

    <div class="slide-header">
      <div class="slide-controls">
        <div class="controls">
          <img src="{% static 'img/icons/settings.svg' %}" />
        </div>
        <div class="controls fullscreen-toggle"
          data-fullscreen = "{% static 'img/icons/fullscreen.svg' %}"
          data-exitfullscreen = "{% static 'img/icons/fullscreen_exit.svg' %}">
          <img src="{% static 'img/icons/fullscreen.svg' %}" />
        </div>
        <div class="controls pause-toggle"
            data-play="{% static 'img/icons/play.svg' %}"
            data-pause="{% static 'img/icons/pause.svg' %}">
          <img src="{% static 'img/icons/pause.svg' %}" />
        </div>
        <div class="controls close-slide">
          <img src="{% static 'img/icons/close.svg' %}" />
        </div>
      </div>
    </div>

    <div class="slideshow">
      <div class="slide active">
        <h1>Let take a moment to honour and remember<br/>{{ memorial.name }}</h1>
      </div>

      <div class="slide">
        <img src="{% if memorial.photo %} {{ memorial.photo.url }} {% else %}{% static 'img/user.jpg' %}{%  endif %}" alt="Naomi N">
        <h3>In Loving Memory of</h3>
        <h2>{{ memorial.name }}</h2>
        <h4>{{ memorial.birth_date }} - {{ memorial.death_date }}</h4>
      </div>

      <div class="slide">
        <img src="img/user.jpg" alt="Person C">
        <h2>Person C</h2>
      </div>
    </div>

    <div class="nav-btn-container">
      <button class="nav-btn nav-left">&#10094;</button>
      <button class="nav-btn nav-right">&#10095;</button>
    </div>
    <center>
      <div class="dots"></div>
    </center>
    <div class="instructions">
      F for fullscreen • Space/Arrows to navigate • ESC to exit
    </div>

  </div>

</body>
</html>


<style>
  html, body {
    padding: 0;
    margin: 0;
  }
  .slider-container {
    width: 100%;
    height: 100dvh;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 34px;
    box-sizing: border-box;
    background: linear-gradient(135deg, #0a0f1c, #10141f);
    color: #f5f5f5;
    position: relative;
    overflow: hidden;
  }

  .slide-header {
    width: 100%;
    height: 50px;
  }

  .slide-controls{
    width: 320px;
    float: right;
    display: flex;
    justify-content: space-between;
    gap: 12px;
  }

  .controls {
    width: 82px;
    height: 44px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
  }

  .slideshow {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .slide {
    text-align: center;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    opacity: 0;
    transition: opacity 1s ease-in-out, transform 1s ease-in-out;
    pointer-events: none;
    font-size: clamp(1.8rem, calc(10+1rem), 5vw);
  }

  .slide.active {
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
    pointer-events: auto;
  }

  .slide img {
      border: 3px solid yellow;
      border-radius: 8px;
      width: 250px;
      height: 250px;
      object-fit: cover;
  }

  .nav-btn-container {
    width: 100%;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    justify-content: space-between;
    pointer-events: none;
  }

  .nav-btn {
    pointer-events: auto;
    background: rgba(0,0,0,0.6);
    border: none;
    color: white;
    padding: 12px;
    cursor: pointer;
    border-radius: 4px;
    font-size: 20px;
    transition: background 0.3s;
  }

  .nav-btn:hover {
    background: rgba(255,255,255,0.3);
  }

  .instructions {
    text-align: center;
  }

  .dot {
      height: 12px;
      width: 12px;
      margin: 0 5px;
      border-radius: 50%;
      background-color: #bbb;
      cursor: pointer;
      transition: background-color 0.3s;
      display: inline-block;
  }

  .dot.active {
      background-color: #ffe600;
  }

</style>

<script>
  const slides = document.querySelectorAll(".slide");
  const prevBtn = document.querySelector(".nav-left");
  const nextBtn = document.querySelector(".nav-right");
  const dotsContainer = document.querySelector(".dots");
  const fullscreenBtn = document.querySelector(".fullscreen-toggle");
  const pauseBtn = document.querySelector(".pause-toggle");
  const closeBtn = document.querySelector(".close-slide");

  let currentIndex = 0;
  let autoSlideInterval;
  let isPaused = false;

  // Create dots dynamically
  slides.forEach((_, i) => {
    const dot = document.createElement("span");
    dot.classList.add("dot");
    if (i === 0) dot.classList.add("active");
    dot.addEventListener("click", () => {
      showSlide(i);
      resetAutoSlide();
    });
    dotsContainer.appendChild(dot);
  });

  const dots = document.querySelectorAll(".dot");

  function showSlide(index) {
    slides[currentIndex].classList.remove("active");
    dots[currentIndex].classList.remove("active");
    currentIndex = (index + slides.length) % slides.length;
    slides[currentIndex].classList.add("active");
    dots[currentIndex].classList.add("active");
  }

  function nextSlide() {
    showSlide(currentIndex + 1);
  }

  function prevSlide() {
    showSlide(currentIndex - 1);
  }

  prevBtn.addEventListener("click", () => {
    prevSlide();
    resetAutoSlide();
  });

  nextBtn.addEventListener("click", () => {
    nextSlide();
    resetAutoSlide();
  });

  // Keyboard controls
  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") {
      prevSlide();
      resetAutoSlide();
    }
    if (e.key === "ArrowRight" || e.key === " " || e.code === "Space") {
      e.preventDefault();
      nextSlide();
      resetAutoSlide();
    }
    if (e.key.toLowerCase() === "f") toggleFullscreen();
    if (e.key === "Escape" && document.fullscreenElement) {
      document.exitFullscreen();
    }
  });

  // Fullscreen toggle
  function toggleFullscreen() {
    const icon = fullscreenBtn.querySelector("img");
    const fullScreenIcon = fullscreenBtn.getAttribute("data-fullscreen");
    const fullScreenExitIcon = fullscreenBtn.getAttribute("data-exitfullscreen");
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
      icon.src = fullScreenExitIcon;
    } else {
      document.exitFullscreen();
      icon.src = fullScreenIcon;
    }
  }

  fullscreenBtn.addEventListener("click", toggleFullscreen);

  // Pause/Resume auto slide
  function togglePause() {
    isPaused = !isPaused;
    const icon = pauseBtn.querySelector("img");
    const playIcon = pauseBtn.getAttribute("data-play");
    const pauseIcon = pauseBtn.getAttribute("data-pause");

    if (isPaused) {
      clearInterval(autoSlideInterval);
      icon.src = playIcon;
    } else {
      startAutoSlide();
      icon.src = pauseIcon;
    }
  }

  pauseBtn.addEventListener("click", togglePause);

  // Close (exit fullscreen if open, else stop slideshow)
  // closeBtn.addEventListener("click", () => {
  //   if (document.fullscreenElement) {
  //     document.exitFullscreen();
  //   } else {
  //     clearInterval(autoSlideInterval);
  //     document.querySelector(".slider-container").style.display = "none";
  //   }
  // });

  closeBtn.addEventListener("click", () => {
    if (document.fullscreenElement) {
      document.exitFullscreen();
    }
    // Redirect back to core page
    window.location.href = "{% url 'memorial:index' %}";
  });

  // Auto slide
  function startAutoSlide() {
    autoSlideInterval = setInterval(() => {
      if (!isPaused) nextSlide();
    }, 2000); // 2 seconds
  }

  function resetAutoSlide() {
    clearInterval(autoSlideInterval);
    if (!isPaused) startAutoSlide();
  }

  startAutoSlide();
</script>
